
<!DOCTYPE html>


<html lang="en" data-content_root="../../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>spinguin.api.core &#8212; Spinguin 0.0.1 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/sphinx-book-theme.css?v=eba8b062" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../../_static/documentation_options.js?v=e645c8fa"></script>
    <script src="../../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '_modules/spinguin/api/core';</script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../../index.html">
  
  
  
  
  
  
    <p class="title logo__title">Spinguin 0.0.1 documentation</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../basics.html">Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../advanced.html">Advanced usage</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Documentation</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../spinguin.html">Spinguin (Basic)</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../spinguin.api.html">Main functionality</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../spinguin.api.parameters.html">Global parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../spinguin.api.basis.html">Basis set</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../spinguin.api.relaxation_properties.html">Relaxation properties</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../spinguin.core.html">Spinguin (Advanced)</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../spinguin.core.basis.html">spinguin.core.basis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../spinguin.core.chem.html">spinguin.core.chem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../spinguin.core.data_io.html">spinguin.core.data_io</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../spinguin.core.hamiltonian.html">spinguin.core.hamiltonian</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../spinguin.core.hide_prints.html">spinguin.core.hide_prints</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../spinguin.core.intersect_indices.html">spinguin.core.intersect_indices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../spinguin.core.la.html">spinguin.core.la</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../spinguin.core.liouvillian.html">spinguin.core.liouvillian</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../spinguin.core.nmr_isotopes.html">spinguin.core.nmr_isotopes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../spinguin.core.operators.html">spinguin.core.operators</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../spinguin.core.propagation.html">spinguin.core.propagation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../spinguin.core.relaxation.html">spinguin.core.relaxation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../spinguin.core.sparse_dot.html">spinguin.core.sparse_dot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../spinguin.core.specutils.html">spinguin.core.specutils</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../spinguin.core.states.html">spinguin.core.states</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../spinguin.core.superoperators.html">spinguin.core.superoperators</a></li>
</ul>
</details></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">



<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>

</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1></h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <h1>Source code for spinguin.api.core</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">core.py</span>

<span class="sd">This module provides user-friendly wrapper functions for the core functionality</span>
<span class="sd">of the Spinguin package.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># Imports</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy.sparse</span> <span class="k">as</span> <span class="nn">sp</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Literal</span>

<span class="kn">from</span> <span class="nn">spinguin.api.parameters</span> <span class="kn">import</span> <span class="n">parameters</span>
<span class="kn">from</span> <span class="nn">spinguin.api.spin_system</span> <span class="kn">import</span> <span class="n">SpinSystem</span>

<span class="kn">from</span> <span class="nn">spinguin.core.chem</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">dissociate</span> <span class="k">as</span> <span class="n">_dissociate</span><span class="p">,</span>
    <span class="n">associate</span> <span class="k">as</span> <span class="n">_associate</span><span class="p">,</span>
    <span class="n">permute_spins</span> <span class="k">as</span> <span class="n">_permute_spins</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">spinguin.core.hamiltonian</span> <span class="kn">import</span> <span class="n">sop_H</span> <span class="k">as</span> <span class="n">_sop_H</span>
<span class="kn">from</span> <span class="nn">spinguin.core.hide_prints</span> <span class="kn">import</span> <span class="n">HidePrints</span>
<span class="kn">from</span> <span class="nn">spinguin.core.liouvillian</span> <span class="kn">import</span> <span class="n">sop_L</span> <span class="k">as</span> <span class="n">liouvillian</span>
<span class="kn">from</span> <span class="nn">spinguin.core.operators</span> <span class="kn">import</span> <span class="n">op_from_string</span> <span class="k">as</span> <span class="n">_op_from_string</span>
<span class="kn">from</span> <span class="nn">spinguin.core.propagation</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">propagator_to_rotframe</span> <span class="k">as</span> <span class="n">_propagator_to_rotframe</span><span class="p">,</span>
    <span class="n">sop_propagator</span> <span class="k">as</span> <span class="n">_sop_propagator</span><span class="p">,</span>
    <span class="n">sop_pulse</span> <span class="k">as</span> <span class="n">_sop_pulse</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">spinguin.core.relaxation</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">sop_R_phenomenological</span> <span class="k">as</span> <span class="n">_sop_R_phenomenological</span><span class="p">,</span>
    <span class="n">sop_R_redfield</span> <span class="k">as</span> <span class="n">_sop_R_redfield</span><span class="p">,</span>
    <span class="n">sop_R_sr2k</span> <span class="k">as</span> <span class="n">_sop_R_sr2k</span><span class="p">,</span>
    <span class="n">ldb_thermalization</span> <span class="k">as</span> <span class="n">_ldb_thermalization</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">spinguin.core.specutils</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">frequency_to_chemical_shift</span><span class="p">,</span>
    <span class="n">resonance_frequency</span> <span class="k">as</span> <span class="n">_resonance_frequency</span><span class="p">,</span>
    <span class="n">spectral_width_to_dwell_time</span> <span class="k">as</span> <span class="n">_spectral_width_to_dwell_time</span><span class="p">,</span>
    <span class="n">spectrum</span> <span class="k">as</span> <span class="n">_spectrum</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">spinguin.core.superoperators</span> <span class="kn">import</span> <span class="n">sop_from_string</span> <span class="k">as</span> <span class="n">_sop_from_string</span>
<span class="kn">from</span> <span class="nn">spinguin.core.states</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">alpha_state</span> <span class="k">as</span> <span class="n">_alpha_state</span><span class="p">,</span>
    <span class="n">beta_state</span> <span class="k">as</span> <span class="n">_beta_state</span><span class="p">,</span>
    <span class="n">equilibrium_state</span> <span class="k">as</span> <span class="n">_equilibrium_state</span><span class="p">,</span>
    <span class="n">measure</span> <span class="k">as</span> <span class="n">_measure</span><span class="p">,</span>
    <span class="n">singlet_state</span> <span class="k">as</span> <span class="n">_singlet_state</span><span class="p">,</span>
    <span class="n">state_from_string</span> <span class="k">as</span> <span class="n">_state_from_string</span><span class="p">,</span>
    <span class="n">state_to_zeeman</span> <span class="k">as</span> <span class="n">_state_to_zeeman</span><span class="p">,</span>
    <span class="n">triplet_minus_state</span> <span class="k">as</span> <span class="n">_triplet_minus_state</span><span class="p">,</span>
    <span class="n">triplet_plus_state</span> <span class="k">as</span> <span class="n">_triplet_plus_state</span><span class="p">,</span>
    <span class="n">triplet_zero_state</span> <span class="k">as</span> <span class="n">_triplet_zero_state</span><span class="p">,</span>
    <span class="n">unit_state</span> <span class="k">as</span> <span class="n">_unit_state</span>
<span class="p">)</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;alpha_state&quot;</span><span class="p">,</span>
    <span class="s2">&quot;associate&quot;</span><span class="p">,</span>
    <span class="s2">&quot;beta_state&quot;</span><span class="p">,</span>
    <span class="s2">&quot;dissociate&quot;</span><span class="p">,</span>
    <span class="s2">&quot;equilibrium_state&quot;</span><span class="p">,</span>
    <span class="s2">&quot;frequency_to_chemical_shift&quot;</span><span class="p">,</span>
    <span class="s2">&quot;hamiltonian&quot;</span><span class="p">,</span>
    <span class="s2">&quot;inversion_recovery&quot;</span><span class="p">,</span>
    <span class="s2">&quot;liouvillian&quot;</span><span class="p">,</span>
    <span class="s2">&quot;measure&quot;</span><span class="p">,</span>
    <span class="s2">&quot;operator&quot;</span><span class="p">,</span>
    <span class="s2">&quot;permute_spins&quot;</span><span class="p">,</span>
    <span class="s2">&quot;propagator&quot;</span><span class="p">,</span>
    <span class="s2">&quot;propagator_to_rotframe&quot;</span><span class="p">,</span>
    <span class="s2">&quot;pulse&quot;</span><span class="p">,</span>
    <span class="s2">&quot;pulse_and_acquire&quot;</span><span class="p">,</span>
    <span class="s2">&quot;relaxation&quot;</span><span class="p">,</span>
    <span class="s2">&quot;resonance_frequency&quot;</span><span class="p">,</span>
    <span class="s2">&quot;singlet_state&quot;</span><span class="p">,</span>
    <span class="s2">&quot;spectral_width_to_dwell_time&quot;</span><span class="p">,</span>
    <span class="s2">&quot;spectrum&quot;</span><span class="p">,</span>
    <span class="s2">&quot;state&quot;</span><span class="p">,</span>
    <span class="s2">&quot;state_to_zeeman&quot;</span><span class="p">,</span>
    <span class="s2">&quot;superoperator&quot;</span><span class="p">,</span>
    <span class="s2">&quot;time_axis&quot;</span><span class="p">,</span>
    <span class="s2">&quot;triplet_minus_state&quot;</span><span class="p">,</span>
    <span class="s2">&quot;triplet_plus_state&quot;</span><span class="p">,</span>
    <span class="s2">&quot;triplet_zero_state&quot;</span><span class="p">,</span>
    <span class="s2">&quot;unit_state&quot;</span>
<span class="p">]</span>

<div class="viewcode-block" id="operator">
<a class="viewcode-back" href="../../../spinguin.api.html#spinguin.api.operator">[docs]</a>
<span class="k">def</span> <span class="nf">operator</span><span class="p">(</span><span class="n">spin_system</span><span class="p">:</span> <span class="n">SpinSystem</span><span class="p">,</span>
             <span class="n">operator</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="n">sp</span><span class="o">.</span><span class="n">csc_array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates an operator for the `spin_system` in Hilbert space from the</span>
<span class="sd">    user-specified `operator` string.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    spin_system : SpinSystem</span>
<span class="sd">        Spin system for which the operator is going to be generated.</span>
<span class="sd">    operator : str</span>
<span class="sd">        Defines the operator to be generated. The operator string must</span>
<span class="sd">        follow the rules below:</span>

<span class="sd">        - Cartesian and ladder operators: `I(component,index)` or </span>
<span class="sd">          `I(component)`. Examples:</span>

<span class="sd">            - `I(x,4)` --&gt; Creates x-operator for spin at index 4.</span>
<span class="sd">            - `I(x)`--&gt; Creates x-operator for all spins.</span>

<span class="sd">        - Spherical tensor operators: `T(l,q,index)` or `T(l,q)`. Examples:</span>

<span class="sd">            - `T(1,-1,3)` --&gt; \</span>
<span class="sd">              Creates operator with `l=1`, `q=-1` for spin at index 3.</span>
<span class="sd">            - `T(1, -1)` --&gt; \</span>
<span class="sd">              Creates operator with `l=1`, `q=-1` for all spins.</span>
<span class="sd">            </span>
<span class="sd">        - Product operators have `*` in between the single-spin operators:</span>
<span class="sd">          `I(z,0) * I(z,1)`</span>
<span class="sd">        - Sums of operators have `+` in between the operators:</span>
<span class="sd">          `I(x,0) + I(x,1)`</span>
<span class="sd">        - Unit operators are ignored in the input. Interpretation of these</span>
<span class="sd">          two is identical: `E * I(z,1)`, `I(z,1)`</span>
<span class="sd">        </span>
<span class="sd">        Special case: An empty `operator` string is considered as unit</span>
<span class="sd">        operator.</span>

<span class="sd">        Whitespace will be ignored in the input.</span>

<span class="sd">        NOTE: Indexing starts from 0!</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    op : ndarray or csc_array</span>
<span class="sd">        An array representing the requested operator.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Construct the operator</span>
    <span class="n">op</span> <span class="o">=</span> <span class="n">_op_from_string</span><span class="p">(</span>
        <span class="n">spins</span> <span class="o">=</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">spins</span><span class="p">,</span>
        <span class="n">operator</span> <span class="o">=</span> <span class="n">operator</span><span class="p">,</span>
        <span class="n">sparse</span> <span class="o">=</span> <span class="n">parameters</span><span class="o">.</span><span class="n">sparse_operator</span>
    <span class="p">)</span>
    
    <span class="k">return</span> <span class="n">op</span></div>


<div class="viewcode-block" id="superoperator">
<a class="viewcode-back" href="../../../spinguin.api.html#spinguin.api.superoperator">[docs]</a>
<span class="k">def</span> <span class="nf">superoperator</span><span class="p">(</span><span class="n">spin_system</span><span class="p">:</span> <span class="n">SpinSystem</span><span class="p">,</span>
                  <span class="n">operator</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                  <span class="n">side</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;comm&quot;</span><span class="p">,</span> <span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;comm&quot;</span>
                  <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="n">sp</span><span class="o">.</span><span class="n">csc_array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates a Liouville-space superoperator for the `spin_system` from the</span>
<span class="sd">    user-specified `operator` string.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    spin_system : SpinSystem</span>
<span class="sd">        Spin system for which the superoperator is going to be generated.</span>
<span class="sd">    operator : str</span>
<span class="sd">        Defines the superoperator to be generated. The operator string must</span>
<span class="sd">        follow the rules below:</span>

<span class="sd">        - Cartesian and ladder operators: `I(component,index)` or</span>
<span class="sd">          `I(component)`. Examples:</span>

<span class="sd">            - `I(x,4)` --&gt; Creates x-operator for spin at index 4.</span>
<span class="sd">            - `I(x)`--&gt; Creates x-operator for all spins.</span>

<span class="sd">        - Spherical tensor operators: `T(l,q,index)` or `T(l,q)`. Examples:</span>

<span class="sd">            - `T(1,-1,3)` --&gt; \</span>
<span class="sd">              Creates operator with `l=1`, `q=-1` for spin at index 3.</span>
<span class="sd">            - `T(1, -1)` --&gt; \</span>
<span class="sd">              Creates operator with `l=1`, `q=-1` for all spins.</span>
<span class="sd">            </span>
<span class="sd">        - Product operators have `*` in between the single-spin operators:</span>
<span class="sd">          `I(z,0) * I(z,1)`</span>
<span class="sd">        - Sums of operators have `+` in between the operators:</span>
<span class="sd">          `I(x,0) + I(x,1)`</span>
<span class="sd">        - Unit operators are ignored in the input. Interpretation of these</span>
<span class="sd">          two is identical: `E * I(z,1)`, `I(z,1)`</span>
<span class="sd">        </span>
<span class="sd">        Special case: An empty `operator` string is considered as unit</span>
<span class="sd">        operator.</span>

<span class="sd">        Whitespace will be ignored in the input.</span>

<span class="sd">        NOTE: Indexing starts from 0!</span>
<span class="sd">    side : {&#39;comm&#39;, &#39;left&#39;, &#39;right&#39;}</span>
<span class="sd">        The type of superoperator:</span>
<span class="sd">        - &#39;comm&#39; -- commutation superoperator (default)</span>
<span class="sd">        - &#39;left&#39; -- left superoperator</span>
<span class="sd">        - &#39;right&#39; -- right superoperator</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    sop : ndarray or csc_array</span>
<span class="sd">        An array representing the requested superoperator.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Check that the basis has been built</span>
    <span class="k">if</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">basis</span><span class="o">.</span><span class="n">basis</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Please build the basis before constructing &quot;</span>
                         <span class="s2">&quot;superoperators.&quot;</span><span class="p">)</span>
        
    <span class="c1"># Construct the superoperator</span>
    <span class="n">sop</span> <span class="o">=</span> <span class="n">_sop_from_string</span><span class="p">(</span>
        <span class="n">operator</span> <span class="o">=</span> <span class="n">operator</span><span class="p">,</span>
        <span class="n">basis</span> <span class="o">=</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">basis</span><span class="o">.</span><span class="n">basis</span><span class="p">,</span>
        <span class="n">spins</span> <span class="o">=</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">spins</span><span class="p">,</span>
        <span class="n">side</span> <span class="o">=</span> <span class="n">side</span><span class="p">,</span>
        <span class="n">sparse</span> <span class="o">=</span> <span class="n">parameters</span><span class="o">.</span><span class="n">sparse_superoperator</span>
    <span class="p">)</span>
        
    <span class="k">return</span> <span class="n">sop</span></div>


<span class="n">INTERACTIONTYPE</span> <span class="o">=</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;zeeman&quot;</span><span class="p">,</span> <span class="s2">&quot;chemical_shift&quot;</span><span class="p">,</span> <span class="s2">&quot;J_coupling&quot;</span><span class="p">]</span>
<span class="n">INTERACTIONDEFAULT</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;zeeman&quot;</span><span class="p">,</span> <span class="s2">&quot;chemical_shift&quot;</span><span class="p">,</span> <span class="s2">&quot;J_coupling&quot;</span><span class="p">]</span>
<div class="viewcode-block" id="hamiltonian">
<a class="viewcode-back" href="../../../spinguin.api.html#spinguin.api.hamiltonian">[docs]</a>
<span class="k">def</span> <span class="nf">hamiltonian</span><span class="p">(</span>
        <span class="n">spin_system</span><span class="p">:</span> <span class="n">SpinSystem</span><span class="p">,</span>
        <span class="n">interactions</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">INTERACTIONTYPE</span><span class="p">]</span> <span class="o">=</span> <span class="n">INTERACTIONDEFAULT</span><span class="p">,</span>
        <span class="n">side</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;comm&quot;</span><span class="p">,</span> <span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;comm&quot;</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="n">sp</span><span class="o">.</span><span class="n">csc_array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates the requested Hamiltonian superoperator for the spin system.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    spin_system : SpinSystem</span>
<span class="sd">        Spin system for which the Hamiltonian is going to be generated.</span>
<span class="sd">    interactions : list, default=[&quot;zeeman&quot;, &quot;chemical_shift&quot;, &quot;J_coupling&quot;]</span>
<span class="sd">        Specifies which interactions are taken into account. The options are:</span>

<span class="sd">        - &#39;zeeman&#39; -- Zeeman interaction</span>
<span class="sd">        - &#39;chemical_shift&#39; -- Isotropic chemical shift</span>
<span class="sd">        - &#39;J_coupling&#39; -- Scalar J-coupling</span>

<span class="sd">    side : {&#39;comm&#39;, &#39;left&#39;, &#39;right&#39;}</span>
<span class="sd">        The type of superoperator:</span>
<span class="sd">        </span>
<span class="sd">        - &#39;comm&#39; -- commutation superoperator (default)</span>
<span class="sd">        - &#39;left&#39; -- left superoperator</span>
<span class="sd">        - &#39;right&#39; -- right superoperator</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    H : ndarray or csc_array</span>
<span class="sd">        Hamiltonian superoperator.</span>
<span class="sd">    &quot;&quot;&quot;</span>
        
    <span class="c1"># Check that the required attributes have been set</span>
    <span class="k">if</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">basis</span><span class="o">.</span><span class="n">basis</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Please build basis before constructing &quot;</span> 
                         <span class="s2">&quot;the Hamiltonian.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;zeeman&quot;</span> <span class="ow">in</span> <span class="n">interactions</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">parameters</span><span class="o">.</span><span class="n">magnetic_field</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Please set the magnetic field before &quot;</span>
                             <span class="s2">&quot;constructing the Zeeman Hamiltonian.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;chemical_shift&quot;</span> <span class="ow">in</span> <span class="n">interactions</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">parameters</span><span class="o">.</span><span class="n">magnetic_field</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Please set the magnetic field before &quot;</span>
                             <span class="s2">&quot;constructing the chemical shift Hamiltonian.&quot;</span><span class="p">)</span>
        
    <span class="n">H</span> <span class="o">=</span> <span class="n">_sop_H</span><span class="p">(</span>
        <span class="n">basis</span> <span class="o">=</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">basis</span><span class="o">.</span><span class="n">basis</span><span class="p">,</span>
        <span class="n">spins</span> <span class="o">=</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">spins</span><span class="p">,</span>
        <span class="n">gammas</span> <span class="o">=</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">gammas</span><span class="p">,</span>
        <span class="n">B</span> <span class="o">=</span> <span class="n">parameters</span><span class="o">.</span><span class="n">magnetic_field</span><span class="p">,</span>
        <span class="n">chemical_shifts</span> <span class="o">=</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">chemical_shifts</span><span class="p">,</span>
        <span class="n">J_couplings</span> <span class="o">=</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">J_couplings</span><span class="p">,</span>
        <span class="n">interactions</span> <span class="o">=</span> <span class="n">interactions</span><span class="p">,</span>
        <span class="n">side</span> <span class="o">=</span> <span class="n">side</span><span class="p">,</span>
        <span class="n">sparse</span> <span class="o">=</span> <span class="n">parameters</span><span class="o">.</span><span class="n">sparse_hamiltonian</span><span class="p">,</span>
        <span class="n">zero_value</span> <span class="o">=</span> <span class="n">parameters</span><span class="o">.</span><span class="n">zero_hamiltonian</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">H</span></div>


<div class="viewcode-block" id="relaxation">
<a class="viewcode-back" href="../../../spinguin.api.html#spinguin.api.relaxation">[docs]</a>
<span class="k">def</span> <span class="nf">relaxation</span><span class="p">(</span><span class="n">spin_system</span><span class="p">:</span> <span class="n">SpinSystem</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="n">sp</span><span class="o">.</span><span class="n">csc_array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates the relaxation superoperator using the requested relaxation theory.</span>

<span class="sd">    Requires that the following spin system properties are set:</span>

<span class="sd">    - spin_system.relaxation.theory : must be specified</span>
<span class="sd">    - spin_system.basis : must be built</span>

<span class="sd">    If `phenomenological` relaxation theory is requested, the following must</span>
<span class="sd">    be set:</span>

<span class="sd">    - spin_system.relaxation.T1</span>
<span class="sd">    - spin_system.relaxation.T2</span>

<span class="sd">    If `redfield` relaxation theory is requested, the following must be set:</span>

<span class="sd">    - spin_system.relaxation.tau_c</span>
<span class="sd">    - parameters.magnetic_field</span>

<span class="sd">    If `sr2k` is requested, the following must be set:</span>

<span class="sd">    - parameters.magnetic_field</span>

<span class="sd">    If `thermalization` is requested, the following must be set:</span>

<span class="sd">    - parameters.magnetic_field</span>
<span class="sd">    - parameters.thermalization</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    spin_system : SpinSystem</span>
<span class="sd">        Spin system for which the relaxation superoperator is going to be</span>
<span class="sd">        generated.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    R : ndarray or csc_array</span>
<span class="sd">        Relaxation superoperator. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check that the required attributes have been set</span>
    <span class="k">if</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">relaxation</span><span class="o">.</span><span class="n">theory</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Please specify relaxation theory before &quot;</span>
                         <span class="s2">&quot;constructing the relaxation superoperator.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">basis</span><span class="o">.</span><span class="n">basis</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Please build basis before constructing the &quot;</span>
                         <span class="s2">&quot;relaxation superoperator.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">relaxation</span><span class="o">.</span><span class="n">theory</span> <span class="o">==</span> <span class="s2">&quot;phenomenological&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">relaxation</span><span class="o">.</span><span class="n">T1</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Please set T1 times before constructing the &quot;</span>
                             <span class="s2">&quot;relaxation superoperator.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">relaxation</span><span class="o">.</span><span class="n">T2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Please set T2 times before constructing the &quot;</span>
                             <span class="s2">&quot;relaxation superoperator.&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">relaxation</span><span class="o">.</span><span class="n">theory</span> <span class="o">==</span> <span class="s2">&quot;redfield&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">relaxation</span><span class="o">.</span><span class="n">tau_c</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Please set the correlation time before &quot;</span>
                             <span class="s2">&quot;constructing the Redfield relaxation &quot;</span>
                             <span class="s2">&quot;superoperator.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">parameters</span><span class="o">.</span><span class="n">magnetic_field</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Please set the magnetic field before &quot;</span>
                             <span class="s2">&quot;constructing the Redfield relaxation &quot;</span>
                             <span class="s2">&quot;superoperator.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">relaxation</span><span class="o">.</span><span class="n">sr2k</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">parameters</span><span class="o">.</span><span class="n">magnetic_field</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Please set the magnetic field before &quot;</span>
                             <span class="s2">&quot;applying scalar relaxation of the second kind.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">relaxation</span><span class="o">.</span><span class="n">thermalization</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">parameters</span><span class="o">.</span><span class="n">magnetic_field</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Please set the magnetic field when applying &quot;</span>
                             <span class="s2">&quot;thermalization.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">parameters</span><span class="o">.</span><span class="n">temperature</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Please define temperature when applying &quot;</span>
                             <span class="s2">&quot;thermalization.&quot;</span><span class="p">)</span>

    <span class="c1"># Make phenomenological relaxation superoperator</span>
    <span class="k">if</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">relaxation</span><span class="o">.</span><span class="n">theory</span> <span class="o">==</span> <span class="s2">&quot;phenomenological&quot;</span><span class="p">:</span>
        <span class="n">R</span> <span class="o">=</span> <span class="n">_sop_R_phenomenological</span><span class="p">(</span>
            <span class="n">basis</span> <span class="o">=</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">basis</span><span class="o">.</span><span class="n">basis</span><span class="p">,</span>
            <span class="n">R1</span> <span class="o">=</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">relaxation</span><span class="o">.</span><span class="n">R1</span><span class="p">,</span>
            <span class="n">R2</span> <span class="o">=</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">relaxation</span><span class="o">.</span><span class="n">R2</span><span class="p">,</span>
            <span class="n">sparse</span> <span class="o">=</span> <span class="n">parameters</span><span class="o">.</span><span class="n">sparse_relaxation</span><span class="p">)</span>

    <span class="c1"># Make relaxation superoperator using Redfield theory</span>
    <span class="k">elif</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">relaxation</span><span class="o">.</span><span class="n">theory</span> <span class="o">==</span> <span class="s2">&quot;redfield&quot;</span><span class="p">:</span>
        
        <span class="c1"># Build the coherent hamiltonian</span>
        <span class="k">with</span> <span class="n">HidePrints</span><span class="p">():</span>
            <span class="n">H</span> <span class="o">=</span> <span class="n">hamiltonian</span><span class="p">(</span><span class="n">spin_system</span><span class="o">=</span><span class="n">spin_system</span><span class="p">,</span>
                            <span class="n">interactions</span><span class="o">=</span><span class="n">INTERACTIONDEFAULT</span><span class="p">,</span>
                            <span class="n">side</span><span class="o">=</span><span class="s2">&quot;comm&quot;</span><span class="p">)</span>

        <span class="c1"># Build the Redfield relaxation superoperator</span>
        <span class="n">R</span> <span class="o">=</span> <span class="n">_sop_R_redfield</span><span class="p">(</span>
            <span class="n">basis</span> <span class="o">=</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">basis</span><span class="o">.</span><span class="n">basis</span><span class="p">,</span>
            <span class="n">sop_H</span> <span class="o">=</span> <span class="n">H</span><span class="p">,</span>
            <span class="n">tau_c</span> <span class="o">=</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">relaxation</span><span class="o">.</span><span class="n">tau_c</span><span class="p">,</span>
            <span class="n">spins</span> <span class="o">=</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">spins</span><span class="p">,</span>
            <span class="n">B</span> <span class="o">=</span> <span class="n">parameters</span><span class="o">.</span><span class="n">magnetic_field</span><span class="p">,</span>
            <span class="n">gammas</span> <span class="o">=</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">gammas</span><span class="p">,</span>
            <span class="n">quad</span> <span class="o">=</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">quad</span><span class="p">,</span>
            <span class="n">xyz</span> <span class="o">=</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">xyz</span><span class="p">,</span>
            <span class="n">shielding</span> <span class="o">=</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">shielding</span><span class="p">,</span>
            <span class="n">efg</span> <span class="o">=</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">efg</span><span class="p">,</span>
            <span class="n">include_antisymmetric</span> <span class="o">=</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">relaxation</span><span class="o">.</span><span class="n">antisymmetric</span><span class="p">,</span>
            <span class="n">include_dynamic_frequency_shift</span> <span class="o">=</span> \
                <span class="n">spin_system</span><span class="o">.</span><span class="n">relaxation</span><span class="o">.</span><span class="n">dynamic_frequency_shift</span><span class="p">,</span>
            <span class="n">relative_error</span> <span class="o">=</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">relaxation</span><span class="o">.</span><span class="n">relative_error</span><span class="p">,</span>
            <span class="n">interaction_zero</span> <span class="o">=</span> <span class="n">parameters</span><span class="o">.</span><span class="n">zero_interaction</span><span class="p">,</span>
            <span class="n">aux_zero</span> <span class="o">=</span> <span class="n">parameters</span><span class="o">.</span><span class="n">zero_aux</span><span class="p">,</span>
            <span class="n">relaxation_zero</span> <span class="o">=</span> <span class="n">parameters</span><span class="o">.</span><span class="n">zero_relaxation</span><span class="p">,</span>
            <span class="n">parallel_dim</span> <span class="o">=</span> <span class="n">parameters</span><span class="o">.</span><span class="n">parallel_dim</span><span class="p">,</span>
            <span class="n">sparse</span> <span class="o">=</span> <span class="n">parameters</span><span class="o">.</span><span class="n">sparse_relaxation</span>
        <span class="p">)</span>
    
    <span class="c1"># Apply scalar relaxation of the second kind if requested</span>
    <span class="k">if</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">relaxation</span><span class="o">.</span><span class="n">sr2k</span><span class="p">:</span>
        <span class="n">R</span> <span class="o">+=</span> <span class="n">_sop_R_sr2k</span><span class="p">(</span>
            <span class="n">basis</span> <span class="o">=</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">basis</span><span class="o">.</span><span class="n">basis</span><span class="p">,</span>
            <span class="n">spins</span> <span class="o">=</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">spins</span><span class="p">,</span>
            <span class="n">gammas</span> <span class="o">=</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">gammas</span><span class="p">,</span>
            <span class="n">chemical_shifts</span> <span class="o">=</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">chemical_shifts</span><span class="p">,</span>
            <span class="n">J_couplings</span> <span class="o">=</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">J_couplings</span><span class="p">,</span>
            <span class="n">sop_R</span> <span class="o">=</span> <span class="n">R</span><span class="p">,</span>
            <span class="n">B</span> <span class="o">=</span> <span class="n">parameters</span><span class="o">.</span><span class="n">magnetic_field</span><span class="p">,</span>
            <span class="n">sparse</span> <span class="o">=</span> <span class="n">parameters</span><span class="o">.</span><span class="n">sparse_relaxation</span>
        <span class="p">)</span>
        
    <span class="c1"># Apply thermalization if requested</span>
    <span class="k">if</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">relaxation</span><span class="o">.</span><span class="n">thermalization</span><span class="p">:</span>
        
        <span class="c1"># Build the left Hamiltonian superopertor</span>
        <span class="k">with</span> <span class="n">HidePrints</span><span class="p">():</span>
            <span class="n">H_left</span> <span class="o">=</span> <span class="n">hamiltonian</span><span class="p">(</span>
                <span class="n">spin_system</span> <span class="o">=</span> <span class="n">spin_system</span><span class="p">,</span>
                <span class="n">interactions</span> <span class="o">=</span> <span class="n">INTERACTIONDEFAULT</span><span class="p">,</span>
                <span class="n">side</span> <span class="o">=</span> <span class="s2">&quot;left&quot;</span>
            <span class="p">)</span>
            
        <span class="c1"># Perform the thermalization</span>
        <span class="n">R</span> <span class="o">=</span> <span class="n">_ldb_thermalization</span><span class="p">(</span>
            <span class="n">R</span> <span class="o">=</span> <span class="n">R</span><span class="p">,</span>
            <span class="n">H_left</span> <span class="o">=</span> <span class="n">H_left</span><span class="p">,</span>
            <span class="n">T</span> <span class="o">=</span> <span class="n">parameters</span><span class="o">.</span><span class="n">temperature</span><span class="p">,</span>
            <span class="n">zero_value</span> <span class="o">=</span> <span class="n">parameters</span><span class="o">.</span><span class="n">zero_thermalization</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">R</span></div>


<div class="viewcode-block" id="equilibrium_state">
<a class="viewcode-back" href="../../../spinguin.api.html#spinguin.api.equilibrium_state">[docs]</a>
<span class="k">def</span> <span class="nf">equilibrium_state</span><span class="p">(</span><span class="n">spin_system</span><span class="p">:</span> <span class="n">SpinSystem</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="n">sp</span><span class="o">.</span><span class="n">csc_array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates the thermal equilibrium state for the spin system.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    spin_system : SpinSystem</span>
<span class="sd">        Spin system for which the equilibrium state is going to be created.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    rho : ndarray or csc_array</span>
<span class="sd">        Equilibrium state vector.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Check that the required attributes are set</span>
    <span class="k">if</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">basis</span><span class="o">.</span><span class="n">basis</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Please build the basis before constructing the &quot;</span>
                         <span class="s2">&quot;equilibrium state.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">parameters</span><span class="o">.</span><span class="n">magnetic_field</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Please set the magnetic field before &quot;</span>
                         <span class="s2">&quot;constructing the equilibrium state.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">parameters</span><span class="o">.</span><span class="n">temperature</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Please set the temperature before &quot;</span>
                         <span class="s2">&quot;constructing the equilibrium state.&quot;</span><span class="p">)</span>

    <span class="c1"># Build the left Hamiltonian superoperator</span>
    <span class="k">with</span> <span class="n">HidePrints</span><span class="p">():</span>
        <span class="n">H_left</span> <span class="o">=</span> <span class="n">hamiltonian</span><span class="p">(</span>
            <span class="n">spin_system</span> <span class="o">=</span> <span class="n">spin_system</span><span class="p">,</span>
            <span class="n">interactions</span> <span class="o">=</span> <span class="n">INTERACTIONDEFAULT</span><span class="p">,</span>
            <span class="n">side</span> <span class="o">=</span> <span class="s2">&quot;left&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Build the equilibrium state</span>
    <span class="n">rho</span> <span class="o">=</span> <span class="n">_equilibrium_state</span><span class="p">(</span>
        <span class="n">basis</span> <span class="o">=</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">basis</span><span class="o">.</span><span class="n">basis</span><span class="p">,</span>
        <span class="n">spins</span> <span class="o">=</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">spins</span><span class="p">,</span>
        <span class="n">H_left</span> <span class="o">=</span> <span class="n">H_left</span><span class="p">,</span>
        <span class="n">T</span> <span class="o">=</span> <span class="n">parameters</span><span class="o">.</span><span class="n">temperature</span><span class="p">,</span>
        <span class="n">sparse</span> <span class="o">=</span> <span class="n">parameters</span><span class="o">.</span><span class="n">sparse_state</span><span class="p">,</span>
        <span class="n">zero_value</span> <span class="o">=</span> <span class="n">parameters</span><span class="o">.</span><span class="n">zero_equilibrium</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">rho</span></div>


<div class="viewcode-block" id="singlet_state">
<a class="viewcode-back" href="../../../spinguin.api.html#spinguin.api.singlet_state">[docs]</a>
<span class="k">def</span> <span class="nf">singlet_state</span><span class="p">(</span><span class="n">spin_system</span><span class="p">:</span> <span class="n">SpinSystem</span><span class="p">,</span>
                  <span class="n">index_1</span> <span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                  <span class="n">index_2</span> <span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="n">sp</span><span class="o">.</span><span class="n">csc_array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates the singlet state between two spin-1/2 nuclei. Unit state is</span>
<span class="sd">    assigned to the other spins.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    spin_system : SpinSystem</span>
<span class="sd">        Spin system for which the singlet state is created.</span>
<span class="sd">    index_1 : int</span>
<span class="sd">        Index of the first spin in the singlet state.</span>
<span class="sd">    index_2 : int</span>
<span class="sd">        Index of the second spin in the singlet state.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    rho : ndarray or csc_array</span>
<span class="sd">        State vector corresponding to the singlet state.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check that the required attributes are set</span>
    <span class="k">if</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">basis</span><span class="o">.</span><span class="n">basis</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Please build the basis before constructing the &quot;</span>
                         <span class="s2">&quot;singlet state.&quot;</span><span class="p">)</span>

    <span class="c1"># Build the singlet state</span>
    <span class="n">rho</span> <span class="o">=</span> <span class="n">_singlet_state</span><span class="p">(</span>
        <span class="n">basis</span> <span class="o">=</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">basis</span><span class="o">.</span><span class="n">basis</span><span class="p">,</span>
        <span class="n">spins</span> <span class="o">=</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">spins</span><span class="p">,</span>
        <span class="n">index_1</span> <span class="o">=</span> <span class="n">index_1</span><span class="p">,</span>
        <span class="n">index_2</span> <span class="o">=</span> <span class="n">index_2</span><span class="p">,</span>
        <span class="n">sparse</span> <span class="o">=</span> <span class="n">parameters</span><span class="o">.</span><span class="n">sparse_state</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">rho</span></div>


<div class="viewcode-block" id="pulse">
<a class="viewcode-back" href="../../../spinguin.api.html#spinguin.api.pulse">[docs]</a>
<span class="k">def</span> <span class="nf">pulse</span><span class="p">(</span><span class="n">spin_system</span><span class="p">:</span> <span class="n">SpinSystem</span><span class="p">,</span>
          <span class="n">operator</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
          <span class="n">angle</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="n">sp</span><span class="o">.</span><span class="n">csc_array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a pulse superoperator that is applied to a state by multiplying</span>
<span class="sd">    from the left.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    spin_system : SpinSystem</span>
<span class="sd">        Spin system for which the pulse superoperator is going to be created.</span>
<span class="sd">    operator : str</span>
<span class="sd">        Defines the pulse to be generated. The operator string must</span>
<span class="sd">        follow the rules below:</span>

<span class="sd">        - Cartesian and ladder operators: `I(component,index)` or</span>
<span class="sd">          `I(component)`. Examples:</span>

<span class="sd">            - `I(x,4)` --&gt; Creates x-operator for spin at index 4.</span>
<span class="sd">            - `I(x)`--&gt; Creates x-operator for all spins.</span>

<span class="sd">        - Spherical tensor operators: `T(l,q,index)` or `T(l,q)`. Examples:</span>

<span class="sd">            - `T(1,-1,3)` --&gt; \</span>
<span class="sd">              Creates operator with `l=1`, `q=-1` for spin at index 3.</span>
<span class="sd">            - `T(1, -1)` --&gt; \</span>
<span class="sd">              Creates operator with `l=1`, `q=-1` for all spins.</span>
<span class="sd">            </span>
<span class="sd">        - Product operators have `*` in between the single-spin operators:</span>
<span class="sd">          `I(z,0) * I(z,1)`</span>
<span class="sd">        - Sums of operators have `+` in between the operators:</span>
<span class="sd">          `I(x,0) + I(x,1)`</span>
<span class="sd">        - Unit operators are ignored in the input. Interpretation of these</span>
<span class="sd">          two is identical: `E * I(z,1)`, `I(z,1)`</span>
<span class="sd">        </span>
<span class="sd">        Special case: An empty `operator` string is considered as unit operator.</span>

<span class="sd">        Whitespace will be ignored in the input.</span>

<span class="sd">        NOTE: Indexing starts from 0!</span>
<span class="sd">    angle : float</span>
<span class="sd">        Pulse angle in degrees.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    P : ndarray or csc_array</span>
<span class="sd">        Pulse superoperator.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Check that the required attributes have been set</span>
    <span class="k">if</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">basis</span><span class="o">.</span><span class="n">basis</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Please build the basis before constructing pulse &quot;</span>
                         <span class="s2">&quot;superoperators.&quot;</span><span class="p">)</span>

    <span class="c1"># Construct the pulse superoperator</span>
    <span class="n">P</span> <span class="o">=</span> <span class="n">_sop_pulse</span><span class="p">(</span>
        <span class="n">basis</span> <span class="o">=</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">basis</span><span class="o">.</span><span class="n">basis</span><span class="p">,</span>
        <span class="n">spins</span> <span class="o">=</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">spins</span><span class="p">,</span>
        <span class="n">operator</span> <span class="o">=</span> <span class="n">operator</span><span class="p">,</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="n">angle</span><span class="p">,</span>
        <span class="n">sparse</span> <span class="o">=</span> <span class="n">parameters</span><span class="o">.</span><span class="n">sparse_pulse</span><span class="p">,</span>
        <span class="n">zero_value</span> <span class="o">=</span> <span class="n">parameters</span><span class="o">.</span><span class="n">zero_pulse</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">P</span></div>


<div class="viewcode-block" id="propagator">
<a class="viewcode-back" href="../../../spinguin.api.html#spinguin.api.propagator">[docs]</a>
<span class="k">def</span> <span class="nf">propagator</span><span class="p">(</span><span class="n">L</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="n">sp</span><span class="o">.</span><span class="n">csc_array</span><span class="p">,</span>
               <span class="n">t</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="n">sp</span><span class="o">.</span><span class="n">csc_array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Constructs the time propagator exp(L*t).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    L : csc_array</span>
<span class="sd">        Liouvillian superoperator, L = -iH - R + K.</span>
<span class="sd">    t : float</span>
<span class="sd">        Time step of the simulation in seconds.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    expm_Lt : csc_array or ndarray</span>
<span class="sd">        Time propagator exp(L*t).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Create the propagator</span>
    <span class="n">P</span> <span class="o">=</span> <span class="n">_sop_propagator</span><span class="p">(</span>
        <span class="n">L</span> <span class="o">=</span> <span class="n">L</span><span class="p">,</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="p">,</span>
        <span class="n">zero_value</span> <span class="o">=</span> <span class="n">parameters</span><span class="o">.</span><span class="n">zero_propagator</span><span class="p">,</span>
        <span class="n">density_threshold</span> <span class="o">=</span> <span class="n">parameters</span><span class="o">.</span><span class="n">propagator_density</span>
    <span class="p">)</span>
    
    <span class="k">return</span> <span class="n">P</span></div>


<div class="viewcode-block" id="propagator_to_rotframe">
<a class="viewcode-back" href="../../../spinguin.api.html#spinguin.api.propagator_to_rotframe">[docs]</a>
<span class="k">def</span> <span class="nf">propagator_to_rotframe</span><span class="p">(</span><span class="n">spin_system</span><span class="p">:</span> <span class="n">SpinSystem</span><span class="p">,</span>
                           <span class="n">P</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="n">sp</span><span class="o">.</span><span class="n">csc_array</span><span class="p">,</span>
                           <span class="n">t</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                           <span class="n">center_frequencies</span><span class="p">:</span> <span class="nb">dict</span><span class="o">=</span><span class="kc">None</span>
                           <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="n">sp</span><span class="o">.</span><span class="n">csc_array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Transforms the time propagator to the rotating frame.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    spin_system : SpinSystem</span>
<span class="sd">        Spin system whose time propagator is going to be transformed.</span>
<span class="sd">    P : ndarray or csc_array</span>
<span class="sd">        Time propagator in the laboratory frame.</span>
<span class="sd">    t : float</span>
<span class="sd">        Time step of the simulation in seconds.</span>
<span class="sd">    center_frequencies : dict</span>
<span class="sd">        Dictionary that describes the center frequencies for each isotope in the</span>
<span class="sd">        units of ppm.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    P_rot : ndarray or csc_array</span>
<span class="sd">        The time propagator transformed into the rotating frame.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Obtain an array of center frequencies for each spin</span>
    <span class="n">center</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">spin_system</span><span class="o">.</span><span class="n">nspins</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">spin</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">spin_system</span><span class="o">.</span><span class="n">nspins</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">isotopes</span><span class="p">[</span><span class="n">spin</span><span class="p">]</span> <span class="ow">in</span> <span class="n">center_frequencies</span><span class="p">:</span>
            <span class="n">center</span><span class="p">[</span><span class="n">spin</span><span class="p">]</span> <span class="o">=</span> <span class="n">center_frequencies</span><span class="p">[</span><span class="n">spin_system</span><span class="o">.</span><span class="n">isotopes</span><span class="p">[</span><span class="n">spin</span><span class="p">]]</span>

    <span class="c1"># Construct Hamiltonian that specifies the interaction frame</span>
    <span class="n">H_frame</span> <span class="o">=</span> <span class="n">_sop_H</span><span class="p">(</span>
        <span class="n">basis</span> <span class="o">=</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">basis</span><span class="o">.</span><span class="n">basis</span><span class="p">,</span>
        <span class="n">spins</span> <span class="o">=</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">spins</span><span class="p">,</span>
        <span class="n">gammas</span> <span class="o">=</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">gammas</span><span class="p">,</span>
        <span class="n">B</span> <span class="o">=</span> <span class="n">parameters</span><span class="o">.</span><span class="n">magnetic_field</span><span class="p">,</span>
        <span class="n">chemical_shifts</span> <span class="o">=</span> <span class="n">center</span><span class="p">,</span>
        <span class="n">interactions</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;zeeman&quot;</span><span class="p">,</span> <span class="s2">&quot;chemical_shift&quot;</span><span class="p">],</span>
        <span class="n">side</span> <span class="o">=</span> <span class="s2">&quot;comm&quot;</span><span class="p">,</span>
        <span class="n">sparse</span> <span class="o">=</span> <span class="n">parameters</span><span class="o">.</span><span class="n">sparse_hamiltonian</span><span class="p">,</span>
        <span class="n">zero_value</span> <span class="o">=</span> <span class="n">parameters</span><span class="o">.</span><span class="n">zero_hamiltonian</span>
    <span class="p">)</span>

    <span class="c1"># Convert the propagator to rotating frame</span>
    <span class="n">P_rot</span> <span class="o">=</span> <span class="n">_propagator_to_rotframe</span><span class="p">(</span>
        <span class="n">sop_P</span> <span class="o">=</span> <span class="n">P</span><span class="p">,</span>
        <span class="n">sop_H0</span> <span class="o">=</span> <span class="n">H_frame</span><span class="p">,</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="p">,</span>
        <span class="n">zero_value</span> <span class="o">=</span> <span class="n">parameters</span><span class="o">.</span><span class="n">zero_propagator</span>
    <span class="p">)</span>
    
    <span class="k">return</span> <span class="n">P_rot</span></div>


<div class="viewcode-block" id="measure">
<a class="viewcode-back" href="../../../spinguin.api.html#spinguin.api.measure">[docs]</a>
<span class="k">def</span> <span class="nf">measure</span><span class="p">(</span><span class="n">spin_system</span><span class="p">:</span> <span class="n">SpinSystem</span><span class="p">,</span>
            <span class="n">rho</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="n">sp</span><span class="o">.</span><span class="n">csc_array</span><span class="p">,</span>
            <span class="n">operator</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">complex</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes the expectation value of the specified operator for a given state</span>
<span class="sd">    vector. Assumes that the state vector `rho` represents a trace-normalized</span>
<span class="sd">    density matrix.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    spin_system : SpinSystem</span>
<span class="sd">        Spin system whose state is going to be measured.</span>
<span class="sd">    rho : ndarray or csc_array</span>
<span class="sd">        State vector that describes the density matrix.</span>
<span class="sd">    operator : str</span>
<span class="sd">        Defines the operator to be measured. The operator string must follow the</span>
<span class="sd">        rules below:</span>

<span class="sd">        - Cartesian and ladder operators: `I(component,index)` or</span>
<span class="sd">          `I(component)`. Examples:</span>

<span class="sd">            - `I(x,4)` --&gt; Creates x-operator for spin at index 4.</span>
<span class="sd">            - `I(x)` --&gt; Creates x-operator for all spins.</span>

<span class="sd">        - Spherical tensor operators: `T(l,q,index)` or `T(l,q)`. Examples:</span>

<span class="sd">            - `T(1,-1,3)` --&gt; \</span>
<span class="sd">              Creates operator with `l=1`, `q=-1` for spin at index 3.</span>
<span class="sd">            - `T(1, -1)` --&gt; \</span>
<span class="sd">              Creates operator with `l=1`, `q=-1` for all spins.</span>
<span class="sd">            </span>
<span class="sd">        - Product operators have `*` in between the single-spin operators:</span>
<span class="sd">          `I(z,0) * I(z,1)`</span>
<span class="sd">        - Sums of operators have `+` in between the operators:</span>
<span class="sd">          `I(x,0) + I(x,1)`</span>
<span class="sd">        - Unit operators are ignored in the input. Interpretation of these</span>
<span class="sd">          two is identical: `E * I(z,1)`, `I(z,1)`</span>
<span class="sd">        </span>
<span class="sd">        Special case: An empty `operator` string is considered as unit operator.</span>

<span class="sd">        Whitespace will be ignored in the input.</span>

<span class="sd">        NOTE: Indexing starts from 0!</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ex : complex</span>
<span class="sd">        Expectation value.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check that the required attributes are set</span>
    <span class="k">if</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">basis</span><span class="o">.</span><span class="n">basis</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Please build the basis before measuring an &quot;</span>
                         <span class="s2">&quot;expectation value of an operator.&quot;</span><span class="p">)</span>
    
    <span class="c1"># Perform the measurement</span>
    <span class="n">ex</span> <span class="o">=</span> <span class="n">_measure</span><span class="p">(</span>
        <span class="n">basis</span> <span class="o">=</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">basis</span><span class="o">.</span><span class="n">basis</span><span class="p">,</span>
        <span class="n">spins</span> <span class="o">=</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">spins</span><span class="p">,</span>
        <span class="n">rho</span> <span class="o">=</span> <span class="n">rho</span><span class="p">,</span>
        <span class="n">operator</span> <span class="o">=</span> <span class="n">operator</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">ex</span></div>


<div class="viewcode-block" id="spectral_width_to_dwell_time">
<a class="viewcode-back" href="../../../spinguin.api.html#spinguin.api.spectral_width_to_dwell_time">[docs]</a>
<span class="k">def</span> <span class="nf">spectral_width_to_dwell_time</span><span class="p">(</span>
        <span class="n">spectral_width</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">isotope</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the dwell time (in seconds) from the spectral width given in ppm.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    spectral_width : float</span>
<span class="sd">        Spectral width in ppm.</span>
<span class="sd">    isotope: str</span>
<span class="sd">        Nucleus symbol (e.g. `&#39;1H&#39;`) used to select the gyromagnetic ratio </span>
<span class="sd">        required for the conversion.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dwell_time : float</span>
<span class="sd">        Dwell time in seconds.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Requires that the following is set:</span>

<span class="sd">    - parameters.magnetic_field</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Obtain the dwell time</span>
    <span class="n">dwell_time</span> <span class="o">=</span> <span class="n">_spectral_width_to_dwell_time</span><span class="p">(</span>
        <span class="n">spectral_width</span> <span class="o">=</span> <span class="n">spectral_width</span><span class="p">,</span>
        <span class="n">isotope</span> <span class="o">=</span> <span class="n">isotope</span><span class="p">,</span>
        <span class="n">B</span> <span class="o">=</span> <span class="n">parameters</span><span class="o">.</span><span class="n">magnetic_field</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">dwell_time</span></div>


<div class="viewcode-block" id="spectrum">
<a class="viewcode-back" href="../../../spinguin.api.html#spinguin.api.spectrum">[docs]</a>
<span class="k">def</span> <span class="nf">spectrum</span><span class="p">(</span><span class="n">signal</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
             <span class="n">dwell_time</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
             <span class="n">normalize</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
             <span class="n">part</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;real&quot;</span><span class="p">,</span> <span class="s2">&quot;imag&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;real&quot;</span>
             <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A wrapper function for the Fourier transform. Computes the Fourier transform</span>
<span class="sd">    and returns the frequency and spectrum (either the real or imaginary part of </span>
<span class="sd">    the Fourier transform).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    signal : ndarray</span>
<span class="sd">        Input signal in the time domain.</span>
<span class="sd">    dwell_time : float</span>
<span class="sd">        Time step between consecutive samples in the signal.</span>
<span class="sd">    normalize : bool, default=True</span>
<span class="sd">        Whether to normalize the Fourier transform.</span>
<span class="sd">    part : {&#39;real&#39;, &#39;imag&#39;}</span>
<span class="sd">        Specifies which part of the Fourier transform to return. Can be &quot;real&quot; </span>
<span class="sd">        or &quot;imag&quot;.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    freqs : ndarray</span>
<span class="sd">        Frequencies corresponding to the Fourier-transformed signal.</span>
<span class="sd">    spectrum : ndarray</span>
<span class="sd">        Specified part (real or imaginary) of the Fourier-transformed signal </span>
<span class="sd">        in the frequency domain.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Required global parameters:</span>

<span class="sd">    - parameters.dwell_time</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Compute the Fourier transform</span>
    <span class="n">freqs</span><span class="p">,</span> <span class="n">spectrum</span> <span class="o">=</span> <span class="n">_spectrum</span><span class="p">(</span>
        <span class="n">signal</span> <span class="o">=</span> <span class="n">signal</span><span class="p">,</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="n">dwell_time</span><span class="p">,</span>
        <span class="n">normalize</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">,</span>
        <span class="n">part</span> <span class="o">=</span> <span class="n">part</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">freqs</span><span class="p">,</span> <span class="n">spectrum</span></div>


<div class="viewcode-block" id="resonance_frequency">
<a class="viewcode-back" href="../../../spinguin.api.html#spinguin.api.resonance_frequency">[docs]</a>
<span class="k">def</span> <span class="nf">resonance_frequency</span><span class="p">(</span>
        <span class="n">isotope</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">offset</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">unit</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;Hz&quot;</span><span class="p">,</span> <span class="s2">&quot;rad/s&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Hz&quot;</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes the resonance frequency of the given `isotope` at the specified</span>
<span class="sd">    magnetic field.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    isotope : str</span>
<span class="sd">        Nucleus symbol (e.g. `&#39;1H&#39;`) used to select the gyromagnetic ratio </span>
<span class="sd">        required for the conversion.</span>
<span class="sd">    offset : float, default=0</span>
<span class="sd">        Offset in ppm.</span>
<span class="sd">    unit : {&#39;Hz&#39;, &#39;rad/s&#39;}</span>
<span class="sd">        Specifies in which units the frequency is returned.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    omega : float</span>
<span class="sd">        Resonance frequency in the requested units.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Required global parameters:</span>

<span class="sd">    - parameters.magnetic_field</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Get the resonance frequency</span>
    <span class="n">omega</span> <span class="o">=</span> <span class="n">_resonance_frequency</span><span class="p">(</span>
        <span class="n">isotope</span> <span class="o">=</span> <span class="n">isotope</span><span class="p">,</span>
        <span class="n">B</span> <span class="o">=</span> <span class="n">parameters</span><span class="o">.</span><span class="n">magnetic_field</span><span class="p">,</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="n">offset</span><span class="p">,</span>
        <span class="n">unit</span> <span class="o">=</span> <span class="n">unit</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">omega</span></div>


<div class="viewcode-block" id="pulse_and_acquire">
<a class="viewcode-back" href="../../../spinguin.api.html#spinguin.api.pulse_and_acquire">[docs]</a>
<span class="k">def</span> <span class="nf">pulse_and_acquire</span><span class="p">(</span>
        <span class="n">spin_system</span><span class="p">:</span> <span class="n">SpinSystem</span><span class="p">,</span>
        <span class="n">isotope</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">center_frequency</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">npoints</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">dwell_time</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">angle</span><span class="p">:</span> <span class="nb">float</span>       
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simple pulse-and-acquire experiment.</span>

<span class="sd">    This experiment requires the following spin system properties to be defined:</span>

<span class="sd">    - spin_system.basis : must be built</span>
<span class="sd">    - spin_system.relaxation.theory</span>
<span class="sd">    - spin_system.relaxation.thermalization : must be True</span>

<span class="sd">    This experiment requires the following parameters to be defined:</span>

<span class="sd">    - parameters.magnetic_field : magnetic field of the spectrometer in Tesla</span>
<span class="sd">    - parameters.temperature : temperature of the sample in Kelvin</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    spin_system : SpinSystem</span>
<span class="sd">        Spin system to which the pulse-and-acquire experiment is performed.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    fid : ndarray</span>
<span class="sd">        Free induction decay signal.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Obtain the Liouvillian</span>
    <span class="n">H</span> <span class="o">=</span> <span class="n">hamiltonian</span><span class="p">(</span><span class="n">spin_system</span><span class="p">)</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">relaxation</span><span class="p">(</span><span class="n">spin_system</span><span class="p">)</span>
    <span class="n">L</span> <span class="o">=</span> <span class="n">liouvillian</span><span class="p">(</span><span class="n">H</span><span class="p">,</span> <span class="n">R</span><span class="p">)</span>

    <span class="c1"># Obtain the equilibrium state</span>
    <span class="n">rho</span> <span class="o">=</span> <span class="n">equilibrium_state</span><span class="p">(</span><span class="n">spin_system</span><span class="p">)</span>

    <span class="c1"># Find indices of the isotopes to be measured</span>
    <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">spin_system</span><span class="o">.</span><span class="n">isotopes</span> <span class="o">==</span> <span class="n">isotope</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Apply pulse</span>
    <span class="n">op_pulse</span> <span class="o">=</span> <span class="s2">&quot;+&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;I(y,</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">)&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">)</span>
    <span class="n">Px</span> <span class="o">=</span> <span class="n">pulse</span><span class="p">(</span><span class="n">spin_system</span><span class="p">,</span> <span class="n">op_pulse</span><span class="p">,</span> <span class="n">angle</span><span class="p">)</span>
    <span class="n">rho</span> <span class="o">=</span> <span class="n">Px</span> <span class="o">@</span> <span class="n">rho</span>

    <span class="c1"># Construct the time propagator</span>
    <span class="n">P</span> <span class="o">=</span> <span class="n">propagator</span><span class="p">(</span><span class="n">L</span><span class="o">=</span><span class="n">L</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">dwell_time</span><span class="p">)</span>
    <span class="n">P</span> <span class="o">=</span> <span class="n">propagator_to_rotframe</span><span class="p">(</span>
        <span class="n">spin_system</span> <span class="o">=</span> <span class="n">spin_system</span><span class="p">,</span>
        <span class="n">P</span> <span class="o">=</span> <span class="n">P</span><span class="p">,</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">dwell_time</span><span class="p">,</span>
        <span class="n">center_frequencies</span> <span class="o">=</span> <span class="p">{</span><span class="n">isotope</span><span class="p">:</span> <span class="n">center_frequency</span><span class="p">})</span>

    <span class="c1"># Initialize an array for storing results</span>
    <span class="n">fid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">npoints</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>

    <span class="c1"># Perform the time evolution</span>
    <span class="n">op_measure</span> <span class="o">=</span> <span class="s2">&quot;+&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;I(-,</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">)&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">npoints</span><span class="p">):</span>
        <span class="n">fid</span><span class="p">[</span><span class="n">step</span><span class="p">]</span> <span class="o">=</span> <span class="n">measure</span><span class="p">(</span><span class="n">spin_system</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">op_measure</span><span class="p">)</span>
        <span class="n">rho</span> <span class="o">=</span> <span class="n">P</span> <span class="o">@</span> <span class="n">rho</span>
    
    <span class="k">return</span> <span class="n">fid</span></div>


<span class="k">def</span> <span class="nf">inversion_recovery_fid</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    TODO</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="inversion_recovery">
<a class="viewcode-back" href="../../../spinguin.api.html#spinguin.api.inversion_recovery">[docs]</a>
<span class="k">def</span> <span class="nf">inversion_recovery</span><span class="p">(</span>
        <span class="n">spin_system</span><span class="p">:</span> <span class="n">SpinSystem</span><span class="p">,</span>
        <span class="n">isotope</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">npoints</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">time_step</span><span class="p">:</span> <span class="nb">float</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Performs the inversion-recovery experiment. The experiment differs slightly</span>
<span class="sd">    from the actual inversion-recovery experiments performed on spectrometers.</span>
<span class="sd">    In this experiment, the inversion is performed only once, and the</span>
<span class="sd">    magnetization is detected at each step during the recovery (much faster).</span>
<span class="sd">    </span>
<span class="sd">    If the traditional inversion recovery is desired, use the function</span>
<span class="sd">    `inversion_recovery_fid()`.</span>

<span class="sd">    This experiment requires the following spin system properties to be defined:</span>

<span class="sd">    - spin_system.basis : must be built</span>
<span class="sd">    - spin_system.relaxation.theory</span>
<span class="sd">    - spin_system.relaxation.thermalization : must be True</span>

<span class="sd">    This experiment requires the following parameters to be defined:</span>

<span class="sd">    - parameters.magnetic_field : magnetic field of the spectrometer in Tesla</span>
<span class="sd">    - parameters.temperature : temperature of the sample in Kelvin</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    spin_system : SpinSystem</span>
<span class="sd">        Spin system to which the inversion-recovery experiment is performed.</span>
<span class="sd">    isotope : str</span>
<span class="sd">        Specifies the isotope, for example &quot;1H&quot;, whose magnetization is inverted</span>
<span class="sd">        and detected. This function applies hard pulses.</span>
<span class="sd">    npoints : int</span>
<span class="sd">        Number of points in the simulation. Defines the total simulation time</span>
<span class="sd">        together with `time_step`.</span>
<span class="sd">    time_step : float</span>
<span class="sd">        Time step in the simulation (in seconds). Should be kept relatively</span>
<span class="sd">        short (e.g. 1 ms).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    magnetizations : ndarray</span>
<span class="sd">        Two-dimensional array of size (nspins, npoints) containing the</span>
<span class="sd">        observed z-magnetizations for each spin at various times.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check that the required attributes have been set</span>
    <span class="k">if</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">basis</span><span class="o">.</span><span class="n">basis</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Please build the basis before using &quot;</span>
                         <span class="s2">&quot;inversion recovery.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">relaxation</span><span class="o">.</span><span class="n">theory</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Please set the relaxation theory before using &quot;</span>
                         <span class="s2">&quot;inversion recovery.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">relaxation</span><span class="o">.</span><span class="n">thermalization</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Please set thermalization to True before using &quot;</span>
                         <span class="s2">&quot;inversion recovery.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">parameters</span><span class="o">.</span><span class="n">magnetic_field</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Please set the magnetic field before using &quot;</span>
                         <span class="s2">&quot;inversion recovery.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">parameters</span><span class="o">.</span><span class="n">temperature</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Please set the temperature before using &quot;</span>
                         <span class="s2">&quot;inversion recovery.&quot;</span><span class="p">)</span>
    
    <span class="c1"># Obtain the Liouvillian</span>
    <span class="n">H</span> <span class="o">=</span> <span class="n">hamiltonian</span><span class="p">(</span><span class="n">spin_system</span><span class="p">)</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">relaxation</span><span class="p">(</span><span class="n">spin_system</span><span class="p">)</span>
    <span class="n">L</span> <span class="o">=</span> <span class="n">liouvillian</span><span class="p">(</span><span class="n">H</span><span class="p">,</span> <span class="n">R</span><span class="p">)</span>

    <span class="c1"># Obtain the equilibrium state</span>
    <span class="n">rho</span> <span class="o">=</span> <span class="n">equilibrium_state</span><span class="p">(</span><span class="n">spin_system</span><span class="p">)</span>

    <span class="c1"># Find indices of the isotopes to be measured</span>
    <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">spin_system</span><span class="o">.</span><span class="n">isotopes</span> <span class="o">==</span> <span class="n">isotope</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">nspins</span> <span class="o">=</span> <span class="n">indices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Apply 180-degree pulse</span>
    <span class="n">operator</span> <span class="o">=</span> <span class="s2">&quot;+&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;I(x,</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">)&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">)</span>
    <span class="n">P180</span> <span class="o">=</span> <span class="n">pulse</span><span class="p">(</span><span class="n">spin_system</span><span class="p">,</span> <span class="n">operator</span><span class="p">,</span> <span class="mi">180</span><span class="p">)</span>
    <span class="n">rho</span> <span class="o">=</span> <span class="n">P180</span> <span class="o">@</span> <span class="n">rho</span>

    <span class="c1"># Change to ZQ-basis to speed up the calculations</span>
    <span class="n">L</span><span class="p">,</span> <span class="n">rho</span> <span class="o">=</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">basis</span><span class="o">.</span><span class="n">truncate_by_coherence</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="n">L</span><span class="p">,</span> <span class="n">rho</span><span class="p">)</span>

    <span class="c1"># Construct the time propagator</span>
    <span class="n">P</span> <span class="o">=</span> <span class="n">propagator</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">time_step</span><span class="p">)</span>

    <span class="c1"># Initialize an array for storing results</span>
    <span class="n">magnetizations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nspins</span><span class="p">,</span> <span class="n">npoints</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>

    <span class="c1"># Perform the time evolution</span>
    <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">npoints</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">indices</span><span class="p">):</span>
            <span class="n">magnetizations</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">step</span><span class="p">]</span> <span class="o">=</span> <span class="n">measure</span><span class="p">(</span><span class="n">spin_system</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;I(z,</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
        <span class="n">rho</span> <span class="o">=</span> <span class="n">P</span> <span class="o">@</span> <span class="n">rho</span>

    <span class="k">return</span> <span class="n">magnetizations</span></div>


<div class="viewcode-block" id="time_axis">
<a class="viewcode-back" href="../../../spinguin.api.html#spinguin.api.time_axis">[docs]</a>
<span class="k">def</span> <span class="nf">time_axis</span><span class="p">(</span><span class="n">npoints</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">time_step</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates a 1D array with `npoints` elements using a constant `time_step`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    npoints : int</span>
<span class="sd">        Number of points.</span>
<span class="sd">    time_step : float</span>
<span class="sd">        Time step (in seconds).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Obtain the time array</span>
    <span class="n">start</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">stop</span> <span class="o">=</span> <span class="n">npoints</span> <span class="o">*</span> <span class="n">time_step</span>
    <span class="n">num</span> <span class="o">=</span> <span class="n">npoints</span>
    <span class="n">t_axis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">t_axis</span></div>


<div class="viewcode-block" id="dissociate">
<a class="viewcode-back" href="../../../spinguin.api.html#spinguin.api.dissociate">[docs]</a>
<span class="k">def</span> <span class="nf">dissociate</span><span class="p">(</span><span class="n">spin_system_A</span><span class="p">:</span> <span class="n">SpinSystem</span><span class="p">,</span>
               <span class="n">spin_system_B</span><span class="p">:</span> <span class="n">SpinSystem</span><span class="p">,</span>
               <span class="n">spin_system_C</span><span class="p">:</span> <span class="n">SpinSystem</span><span class="p">,</span>
               <span class="n">rho_C</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="n">sp</span><span class="o">.</span><span class="n">csc_array</span><span class="p">,</span>
               <span class="n">spin_map_A</span><span class="p">:</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">tuple</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
               <span class="n">spin_map_B</span><span class="p">:</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">tuple</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
               <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="n">sp</span><span class="o">.</span><span class="n">csc_array</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="n">sp</span><span class="o">.</span><span class="n">csc_array</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Dissociates the density vector of composite system C into density vectors of</span>
<span class="sd">    two subsystems A and B in a chemical reaction C -&gt; A + B.</span>

<span class="sd">    Example. Spin system C has five spins, which are indexed as (0, 1, 2, 3, 4).</span>
<span class="sd">    We want to dissociate this into two subsystems A and B. Spins 0 and 2 should</span>
<span class="sd">    go to subsystem A and the rest to subsystem B. In this case, we define the</span>
<span class="sd">    following spin maps::</span>

<span class="sd">        spin_map_A = np.array([0, 2])</span>
<span class="sd">        spin_map_B = np.array([1, 3, 4])</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    spin_system_A : SpinSystem</span>
<span class="sd">        Spin system A.</span>
<span class="sd">    spin_system_B : SpinSystem</span>
<span class="sd">        Spin system B.</span>
<span class="sd">    spin_system_C : SpinSystem</span>
<span class="sd">        Spin system C.</span>
<span class="sd">    rho_C : ndarray or csc_array</span>
<span class="sd">        State vector of the composite spin system C.</span>
<span class="sd">    spin_map_A : list or tuple or ndarray</span>
<span class="sd">        Indices of spin system A within spin system C.</span>
<span class="sd">    spin_map_B : list or tuple or ndarray</span>
<span class="sd">        Indices of spin system B within spin system C.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    rho_A : ndarray or csc_array</span>
<span class="sd">        State vector of spin system A.</span>
<span class="sd">    rho_B : ndarray or csc_array</span>
<span class="sd">        State vector of spin system B.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Perform the dissociation</span>
    <span class="n">rho_A</span><span class="p">,</span> <span class="n">rho_B</span> <span class="o">=</span> <span class="n">_dissociate</span><span class="p">(</span>
        <span class="n">basis_A</span> <span class="o">=</span> <span class="n">spin_system_A</span><span class="o">.</span><span class="n">basis</span><span class="o">.</span><span class="n">basis</span><span class="p">,</span>
        <span class="n">basis_B</span> <span class="o">=</span> <span class="n">spin_system_B</span><span class="o">.</span><span class="n">basis</span><span class="o">.</span><span class="n">basis</span><span class="p">,</span>
        <span class="n">basis_C</span> <span class="o">=</span> <span class="n">spin_system_C</span><span class="o">.</span><span class="n">basis</span><span class="o">.</span><span class="n">basis</span><span class="p">,</span>
        <span class="n">spins_A</span> <span class="o">=</span> <span class="n">spin_system_A</span><span class="o">.</span><span class="n">spins</span><span class="p">,</span>
        <span class="n">spins_B</span> <span class="o">=</span> <span class="n">spin_system_B</span><span class="o">.</span><span class="n">spins</span><span class="p">,</span>
        <span class="n">rho_C</span> <span class="o">=</span> <span class="n">rho_C</span><span class="p">,</span>
        <span class="n">spin_map_A</span> <span class="o">=</span> <span class="n">spin_map_A</span><span class="p">,</span>
        <span class="n">spin_map_B</span> <span class="o">=</span> <span class="n">spin_map_B</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">rho_A</span><span class="p">,</span> <span class="n">rho_B</span></div>


<div class="viewcode-block" id="associate">
<a class="viewcode-back" href="../../../spinguin.api.html#spinguin.api.associate">[docs]</a>
<span class="k">def</span> <span class="nf">associate</span><span class="p">(</span><span class="n">spin_system_A</span><span class="p">:</span> <span class="n">SpinSystem</span><span class="p">,</span>
              <span class="n">spin_system_B</span><span class="p">:</span> <span class="n">SpinSystem</span><span class="p">,</span>
              <span class="n">spin_system_C</span><span class="p">:</span> <span class="n">SpinSystem</span><span class="p">,</span>
              <span class="n">rho_A</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="n">sp</span><span class="o">.</span><span class="n">csc_array</span><span class="p">,</span>
              <span class="n">rho_B</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="n">sp</span><span class="o">.</span><span class="n">csc_array</span><span class="p">,</span>
              <span class="n">spin_map_A</span><span class="p">:</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">tuple</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
              <span class="n">spin_map_B</span><span class="p">:</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">tuple</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="n">sp</span><span class="o">.</span><span class="n">csc_array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Combines two state vectors when spin systems associate in a chemical</span>
<span class="sd">    reaction A + B -&gt; C.</span>

<span class="sd">    Example. We have spin system A that has two spins and spin system B that has</span>
<span class="sd">    three spins. These systems associate to form a composite spin system C that</span>
<span class="sd">    has five spins that are indexed (0, 1, 2, 3, 4). Of these, spins (0, 2) are</span>
<span class="sd">    from subsystem A and (1, 3, 4) from subsystem B. We have to choose how the</span>
<span class="sd">    spin systems A and B will be indexed in spin system C by defining the spin</span>
<span class="sd">    maps as follows::</span>

<span class="sd">        spin_map_A = np.ndarray([0, 2])</span>
<span class="sd">        spin_map_B = np.ndarray([1, 3, 4])</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    spin_system_A : SpinSystem</span>
<span class="sd">        Spin system A.</span>
<span class="sd">    spin_system_B : SpinSystem</span>
<span class="sd">        Spin system B.</span>
<span class="sd">    spin_system_C : SpinSystem</span>
<span class="sd">        Spin system C.</span>
<span class="sd">    rho_A : ndarray or csc_array</span>
<span class="sd">        State vector of spin system A.</span>
<span class="sd">    rho_B : ndarray or csc_array</span>
<span class="sd">        State vector of spin system B.</span>
<span class="sd">    spin_map_A : list or tuple or ndarray</span>
<span class="sd">        Indices of spin system A within spin system C.</span>
<span class="sd">    spin_map_B : list or tuple or ndarray</span>
<span class="sd">        Indices of spin system B within spin system C.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    rho_C : ndarray or csc_array</span>
<span class="sd">        State vector of the composite spin system C.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Perform the association</span>
    <span class="n">rho_C</span> <span class="o">=</span> <span class="n">_associate</span><span class="p">(</span>
        <span class="n">basis_A</span> <span class="o">=</span> <span class="n">spin_system_A</span><span class="o">.</span><span class="n">basis</span><span class="o">.</span><span class="n">basis</span><span class="p">,</span>
        <span class="n">basis_B</span> <span class="o">=</span> <span class="n">spin_system_B</span><span class="o">.</span><span class="n">basis</span><span class="o">.</span><span class="n">basis</span><span class="p">,</span>
        <span class="n">basis_C</span> <span class="o">=</span> <span class="n">spin_system_C</span><span class="o">.</span><span class="n">basis</span><span class="o">.</span><span class="n">basis</span><span class="p">,</span>
        <span class="n">rho_A</span> <span class="o">=</span> <span class="n">rho_A</span><span class="p">,</span>
        <span class="n">rho_B</span> <span class="o">=</span> <span class="n">rho_B</span><span class="p">,</span>
        <span class="n">spin_map_A</span> <span class="o">=</span> <span class="n">spin_map_A</span><span class="p">,</span>
        <span class="n">spin_map_B</span> <span class="o">=</span> <span class="n">spin_map_B</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">rho_C</span></div>


<div class="viewcode-block" id="permute_spins">
<a class="viewcode-back" href="../../../spinguin.api.html#spinguin.api.permute_spins">[docs]</a>
<span class="k">def</span> <span class="nf">permute_spins</span><span class="p">(</span><span class="n">spin_system</span><span class="p">:</span> <span class="n">SpinSystem</span><span class="p">,</span>
                  <span class="n">rho</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="n">sp</span><span class="o">.</span><span class="n">csc_array</span><span class="p">,</span>
                  <span class="n">spin_map</span><span class="p">:</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">tuple</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="n">sp</span><span class="o">.</span><span class="n">csc_array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Permutes the state vector of a spin system to correspond to a reordering</span>
<span class="sd">    of the spins in the system. </span>

<span class="sd">    Example. Our spin system has three spins, which are indexed (0, 1, 2). We</span>
<span class="sd">    want to perform the following permulation:</span>

<span class="sd">    - 0 --&gt; 2 (Spin 0 goes to position 2)</span>
<span class="sd">    - 1 --&gt; 0 (Spin 1 goes to position 0)</span>
<span class="sd">    - 2 --&gt; 1 (Spin 2 goes to position 1)</span>

<span class="sd">    In this case, we want to assign the following map::</span>

<span class="sd">        spin_map = np.array([2, 0, 1])</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    spin_system : SpinSystem</span>
<span class="sd">        The spin system whose density vector is going to be permuted.</span>
<span class="sd">    rho : ndarray or csc_array</span>
<span class="sd">        State vector of the spin system.</span>
<span class="sd">    spin_map : list or tuple or ndarray</span>
<span class="sd">        Indices of the spins in the spin system after permutation.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    rho : ndarray or csc_array</span>
<span class="sd">        Permuted state vector of the spin system.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Perform the permutation</span>
    <span class="n">rho</span> <span class="o">=</span> <span class="n">_permute_spins</span><span class="p">(</span>
        <span class="n">basis</span> <span class="o">=</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">basis</span><span class="o">.</span><span class="n">basis</span><span class="p">,</span>
        <span class="n">rho</span> <span class="o">=</span> <span class="n">rho</span><span class="p">,</span>
        <span class="n">spin_map</span> <span class="o">=</span> <span class="n">spin_map</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">rho</span></div>


<div class="viewcode-block" id="unit_state">
<a class="viewcode-back" href="../../../spinguin.api.html#spinguin.api.unit_state">[docs]</a>
<span class="k">def</span> <span class="nf">unit_state</span><span class="p">(</span><span class="n">spin_system</span><span class="p">:</span> <span class="n">SpinSystem</span><span class="p">,</span>
               <span class="n">normalized</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="n">sp</span><span class="o">.</span><span class="n">csc_array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a unit state vector, which represents the identity operator. The</span>
<span class="sd">    output can be either normalised (trace equal to one) or unnormalised (raw</span>
<span class="sd">    identity matrix).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    spin_system : SpinSystem</span>
<span class="sd">        Spin system to which the unit state is created.</span>
<span class="sd">    normalized : bool, default=True</span>
<span class="sd">        If set to True, the function will return a state vector that represents</span>
<span class="sd">        the trace-normalized density matrix. If False, returns a state vector</span>
<span class="sd">        that corresponds to the identity operator.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    rho : ndarray or csc_array</span>
<span class="sd">        State vector corresponding to the unit state.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Create the unit state</span>
    <span class="n">rho</span> <span class="o">=</span> <span class="n">_unit_state</span><span class="p">(</span>
        <span class="n">basis</span> <span class="o">=</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">basis</span><span class="o">.</span><span class="n">basis</span><span class="p">,</span>
        <span class="n">spins</span> <span class="o">=</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">spins</span><span class="p">,</span>
        <span class="n">sparse</span> <span class="o">=</span> <span class="n">parameters</span><span class="o">.</span><span class="n">sparse_state</span><span class="p">,</span>
        <span class="n">normalized</span> <span class="o">=</span> <span class="n">normalized</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">rho</span></div>


<div class="viewcode-block" id="state">
<a class="viewcode-back" href="../../../spinguin.api.html#spinguin.api.state">[docs]</a>
<span class="k">def</span> <span class="nf">state</span><span class="p">(</span><span class="n">spin_system</span><span class="p">:</span> <span class="n">SpinSystem</span><span class="p">,</span>
          <span class="n">operator</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="n">sp</span><span class="o">.</span><span class="n">csc_array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function returns a column vector representing the density matrix as a</span>
<span class="sd">    linear combination of spin operators. Each element of the vector corresponds</span>
<span class="sd">    to the coefficient of a specific spin operator in the expansion.</span>
<span class="sd">    </span>
<span class="sd">    Normalization:</span>
<span class="sd">    The output of this function uses a normalised basis built from normalised</span>
<span class="sd">    products of single-spin spherical tensor operators. However, the</span>
<span class="sd">    coefficients are scaled so that the resulting linear combination represents</span>
<span class="sd">    the non-normalised version of the requested operator.</span>

<span class="sd">    NOTE: This function is sometimes called often and is cached for high</span>
<span class="sd">    performance.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    spin_system : SpinSystem</span>
<span class="sd">        Spin system for which the state is created.</span>
<span class="sd">    operator : str</span>
<span class="sd">        Defines the state to be generated. The operator string must follow the</span>
<span class="sd">        rules below:</span>

<span class="sd">        - Cartesian and ladder operators: `I(component,index)` or</span>
<span class="sd">          `I(component)`. Examples:</span>

<span class="sd">            - `I(x,4)` --&gt; Creates x-operator for spin at index 4.</span>
<span class="sd">            - `I(x)`--&gt; Creates x-operator for all spins.</span>

<span class="sd">        - Spherical tensor operators: `T(l,q,index)` or `T(l,q)`. Examples:</span>

<span class="sd">            - `T(1,-1,3)` --&gt; \</span>
<span class="sd">              Creates operator with `l=1`, `q=-1` for spin at index 3.</span>
<span class="sd">            - `T(1, -1)` --&gt; \</span>
<span class="sd">              Creates operator with `l=1`, `q=-1` for all spins.</span>
<span class="sd">            </span>
<span class="sd">        - Product operators have `*` in between the single-spin operators:</span>
<span class="sd">          `I(z,0) * I(z,1)`</span>
<span class="sd">        - Sums of operators have `+` in between the operators:</span>
<span class="sd">          `I(x,0) + I(x,1)`</span>
<span class="sd">        - Unit operators are ignored in the input. Interpretation of these</span>
<span class="sd">          two is identical: `E * I(z,1)`, `I(z,1)`</span>
<span class="sd">        </span>
<span class="sd">        Special case: An empty `operator` string is considered as unit operator.</span>

<span class="sd">        Whitespace will be ignored in the input.</span>

<span class="sd">        NOTE: Indexing starts from 0!</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    rho : ndarray or csc_array</span>
<span class="sd">        State vector corresponding to the requested state.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check that the required attributes are set</span>
    <span class="k">if</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">basis</span><span class="o">.</span><span class="n">basis</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Please build the basis before constructing a state.&quot;</span><span class="p">)</span>
    
    <span class="c1"># Build the state</span>
    <span class="n">rho</span> <span class="o">=</span> <span class="n">_state_from_string</span><span class="p">(</span>
        <span class="n">basis</span> <span class="o">=</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">basis</span><span class="o">.</span><span class="n">basis</span><span class="p">,</span>
        <span class="n">spins</span> <span class="o">=</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">spins</span><span class="p">,</span>
        <span class="n">operator</span> <span class="o">=</span> <span class="n">operator</span><span class="p">,</span>
        <span class="n">sparse</span> <span class="o">=</span> <span class="n">parameters</span><span class="o">.</span><span class="n">sparse_state</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">rho</span></div>


<div class="viewcode-block" id="state_to_zeeman">
<a class="viewcode-back" href="../../../spinguin.api.html#spinguin.api.state_to_zeeman">[docs]</a>
<span class="k">def</span> <span class="nf">state_to_zeeman</span><span class="p">(</span>
        <span class="n">spin_system</span><span class="p">:</span> <span class="n">SpinSystem</span><span class="p">,</span>
        <span class="n">rho</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="n">sp</span><span class="o">.</span><span class="n">csc_array</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="n">sp</span><span class="o">.</span><span class="n">csc_array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Takes the state vector defined in the normalized spherical tensor basis</span>
<span class="sd">    and converts it into the Zeeman eigenbasis. Useful for error checking.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    spin_system : SpinSystem</span>
<span class="sd">        Spin system whose state vector is going to be converted into a density</span>
<span class="sd">        matrix.</span>
<span class="sd">    rho : ndarray or csc_array</span>
<span class="sd">        State vector defined in the normalized spherical tensor basis.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    rho_zeeman : ndarray or csc_array</span>
<span class="sd">        Spin density matrix defined in the Zeeman eigenbasis.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check that the required attributes are set</span>
    <span class="k">if</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">basis</span><span class="o">.</span><span class="n">basis</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Please build the basis before converting the &quot;</span>
                         <span class="s2">&quot;state vector into density matrix.&quot;</span><span class="p">)</span>
    
    <span class="c1"># Convert the state vector into density matrix</span>
    <span class="n">rho_zeeman</span> <span class="o">=</span> <span class="n">_state_to_zeeman</span><span class="p">(</span>
        <span class="n">basis</span> <span class="o">=</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">basis</span><span class="o">.</span><span class="n">basis</span><span class="p">,</span>
        <span class="n">spins</span> <span class="o">=</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">spins</span><span class="p">,</span>
        <span class="n">rho</span> <span class="o">=</span> <span class="n">rho</span><span class="p">,</span>
        <span class="n">sparse</span> <span class="o">=</span> <span class="n">parameters</span><span class="o">.</span><span class="n">sparse_state</span>
    <span class="p">)</span>
    
    <span class="k">return</span> <span class="n">rho_zeeman</span></div>


<div class="viewcode-block" id="alpha_state">
<a class="viewcode-back" href="../../../spinguin.api.html#spinguin.api.alpha_state">[docs]</a>
<span class="k">def</span> <span class="nf">alpha_state</span><span class="p">(</span><span class="n">spin_system</span><span class="p">:</span> <span class="n">SpinSystem</span><span class="p">,</span>
                <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="n">sp</span><span class="o">.</span><span class="n">csc_array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates the alpha state for a given spin-1/2 nucleus. Unit state is</span>
<span class="sd">    assigned to the other spins.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    spin_system: SpinSystem</span>
<span class="sd">        Spin system for which the alpha state is created.</span>
<span class="sd">    index : int</span>
<span class="sd">        Index of the spin that has the alpha state.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    rho : ndarray or csc_array</span>
<span class="sd">        State vector corresponding to the alpha state of the given spin index.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check that the required attributes are set</span>
    <span class="k">if</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">basis</span><span class="o">.</span><span class="n">basis</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Please build the basis before constructing the &quot;</span>
                         <span class="s2">&quot;alpha state.&quot;</span><span class="p">)</span>
    
    <span class="c1"># Create the alpha state</span>
    <span class="n">rho</span> <span class="o">=</span> <span class="n">_alpha_state</span><span class="p">(</span>
        <span class="n">basis</span> <span class="o">=</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">basis</span><span class="o">.</span><span class="n">basis</span><span class="p">,</span>
        <span class="n">spins</span> <span class="o">=</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">spins</span><span class="p">,</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">index</span><span class="p">,</span>
        <span class="n">sparse</span> <span class="o">=</span> <span class="n">parameters</span><span class="o">.</span><span class="n">sparse_state</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">rho</span></div>


<div class="viewcode-block" id="beta_state">
<a class="viewcode-back" href="../../../spinguin.api.html#spinguin.api.beta_state">[docs]</a>
<span class="k">def</span> <span class="nf">beta_state</span><span class="p">(</span><span class="n">spin_system</span><span class="p">:</span> <span class="n">SpinSystem</span><span class="p">,</span>
               <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="n">sp</span><span class="o">.</span><span class="n">csc_array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates the beta state for a given spin-1/2 nucleus. Unit state is</span>
<span class="sd">    assigned to the other spins.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    spin_system: SpinSystem</span>
<span class="sd">        Spin system for which the beta state is created.</span>
<span class="sd">    index : int</span>
<span class="sd">        Index of the spin that has the beta state.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    rho : ndarray or csc_array</span>
<span class="sd">        State vector corresponding to the beta state of the given spin index.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check that the required attributes are set</span>
    <span class="k">if</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">basis</span><span class="o">.</span><span class="n">basis</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Please build the basis before constructing the &quot;</span>
                         <span class="s2">&quot;beta state.&quot;</span><span class="p">)</span>
    
    <span class="c1"># Create the beta state</span>
    <span class="n">rho</span> <span class="o">=</span> <span class="n">_beta_state</span><span class="p">(</span>
        <span class="n">basis</span> <span class="o">=</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">basis</span><span class="o">.</span><span class="n">basis</span><span class="p">,</span>
        <span class="n">spins</span> <span class="o">=</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">spins</span><span class="p">,</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">index</span><span class="p">,</span>
        <span class="n">sparse</span> <span class="o">=</span> <span class="n">parameters</span><span class="o">.</span><span class="n">sparse_state</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">rho</span></div>


<div class="viewcode-block" id="triplet_zero_state">
<a class="viewcode-back" href="../../../spinguin.api.html#spinguin.api.triplet_zero_state">[docs]</a>
<span class="k">def</span> <span class="nf">triplet_zero_state</span><span class="p">(</span><span class="n">spin_system</span><span class="p">:</span> <span class="n">SpinSystem</span><span class="p">,</span>
                       <span class="n">index_1</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                       <span class="n">index_2</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="n">sp</span><span class="o">.</span><span class="n">csc_array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates the triplet zero state between two spin-1/2 nuclei. Unit state is</span>
<span class="sd">    assigned to the other spins.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    spin_system: SpinSystem</span>
<span class="sd">        Spin system for which the triplet zero state is created.</span>
<span class="sd">    index_1 : int</span>
<span class="sd">        Index of the first spin in the triplet zero state.</span>
<span class="sd">    index_2 : int</span>
<span class="sd">        Index of the second spin in the triplet zero state.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    rho : ndarray or csc_array</span>
<span class="sd">        State vector corresponding to the triplet zero state.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check that the required attributes are set</span>
    <span class="k">if</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">basis</span><span class="o">.</span><span class="n">basis</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Please build the basis before constructing the &quot;</span>
                         <span class="s2">&quot;triplet zero state.&quot;</span><span class="p">)</span>
    
    <span class="c1"># Make the triplet zero state</span>
    <span class="n">rho</span> <span class="o">=</span> <span class="n">_triplet_zero_state</span><span class="p">(</span>
        <span class="n">basis</span> <span class="o">=</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">basis</span><span class="o">.</span><span class="n">basis</span><span class="p">,</span>
        <span class="n">spins</span> <span class="o">=</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">spins</span><span class="p">,</span>
        <span class="n">index_1</span> <span class="o">=</span> <span class="n">index_1</span><span class="p">,</span>
        <span class="n">index_2</span> <span class="o">=</span> <span class="n">index_2</span><span class="p">,</span>
        <span class="n">sparse</span> <span class="o">=</span> <span class="n">parameters</span><span class="o">.</span><span class="n">sparse_state</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">rho</span></div>


<div class="viewcode-block" id="triplet_plus_state">
<a class="viewcode-back" href="../../../spinguin.api.html#spinguin.api.triplet_plus_state">[docs]</a>
<span class="k">def</span> <span class="nf">triplet_plus_state</span><span class="p">(</span><span class="n">spin_system</span><span class="p">:</span> <span class="n">SpinSystem</span><span class="p">,</span>
                       <span class="n">index_1</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                       <span class="n">index_2</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="n">sp</span><span class="o">.</span><span class="n">csc_array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates the triplet plus state between two spin-1/2 nuclei. Unit state is</span>
<span class="sd">    assigned to the other spins.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    spin_system : SpinSystem</span>
<span class="sd">        Spin system for which the triplet plus state is created.</span>
<span class="sd">    index_1 : int</span>
<span class="sd">        Index of the first spin in the triplet plus state.</span>
<span class="sd">    index_2 : int</span>
<span class="sd">        Index of the second spin in the triplet plus state.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    rho : ndarray or csc_array</span>
<span class="sd">        State vector corresponding to the triplet plus state.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check that the required attributes are set</span>
    <span class="k">if</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">basis</span><span class="o">.</span><span class="n">basis</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Please build the basis before constructing the &quot;</span>
                         <span class="s2">&quot;triplet plus state.&quot;</span><span class="p">)</span>
    
    <span class="c1"># Create the triplet plus state</span>
    <span class="n">rho</span> <span class="o">=</span> <span class="n">_triplet_plus_state</span><span class="p">(</span>
        <span class="n">basis</span> <span class="o">=</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">basis</span><span class="o">.</span><span class="n">basis</span><span class="p">,</span>
        <span class="n">spins</span> <span class="o">=</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">spins</span><span class="p">,</span>
        <span class="n">index_1</span> <span class="o">=</span> <span class="n">index_1</span><span class="p">,</span>
        <span class="n">index_2</span> <span class="o">=</span> <span class="n">index_2</span><span class="p">,</span>
        <span class="n">sparse</span> <span class="o">=</span> <span class="n">parameters</span><span class="o">.</span><span class="n">sparse_state</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">rho</span></div>


<div class="viewcode-block" id="triplet_minus_state">
<a class="viewcode-back" href="../../../spinguin.api.html#spinguin.api.triplet_minus_state">[docs]</a>
<span class="k">def</span> <span class="nf">triplet_minus_state</span><span class="p">(</span><span class="n">spin_system</span><span class="p">:</span> <span class="n">SpinSystem</span><span class="p">,</span>
                        <span class="n">index_1</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                        <span class="n">index_2</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="n">sp</span><span class="o">.</span><span class="n">csc_array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates the triplet minus state between two spin-1/2 nuclei. Unit state is</span>
<span class="sd">    assigned to the other spins.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    spin_system : SpinSystem</span>
<span class="sd">        Spin system for which the triplet minus state is created.</span>
<span class="sd">    index_1 : int</span>
<span class="sd">        Index of the first spin in the triplet minus state.</span>
<span class="sd">    index_2 : int</span>
<span class="sd">        Index of the second spin in the triplet minus state.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    rho : ndarray or csc_array</span>
<span class="sd">        State vector corresponding to the triplet minus state.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check that the required attributes are set</span>
    <span class="k">if</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">basis</span><span class="o">.</span><span class="n">basis</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Please build the basis before constructing the &quot;</span>
                         <span class="s2">&quot;triplet minus state.&quot;</span><span class="p">)</span>
    
    <span class="c1"># Create the triplet minus state</span>
    <span class="n">rho</span> <span class="o">=</span> <span class="n">_triplet_minus_state</span><span class="p">(</span>
        <span class="n">basis</span> <span class="o">=</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">basis</span><span class="o">.</span><span class="n">basis</span><span class="p">,</span>
        <span class="n">spins</span> <span class="o">=</span> <span class="n">spin_system</span><span class="o">.</span><span class="n">spins</span><span class="p">,</span>
        <span class="n">index_1</span> <span class="o">=</span> <span class="n">index_1</span><span class="p">,</span>
        <span class="n">index_2</span> <span class="o">=</span> <span class="n">index_2</span><span class="p">,</span>
        <span class="n">sparse</span> <span class="o">=</span> <span class="n">parameters</span><span class="o">.</span><span class="n">sparse_state</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">rho</span></div>

</pre></div>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Joni Eronen, Perttu Hilla
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2025, Joni Eronen, Perttu Hilla.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>